{% extends "base.html" %}

{% block title %}Student Details - Sityog Library Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h1><i class="fas fa-user me-2"></i>Student Details</h1>
    </div>
    <div class="col-md-4 text-end">
        <a href="{{ url_for('students') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Students
        </a>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-user me-2"></i>Student Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Student ID:</strong> <span class="badge bg-primary">{{ student.student_id or 'STU-' + "%04d"|format(student.id) }}</span></p>
                        <p><strong>Full Name:</strong> {{ student.full_name }}</p>
                        <p><strong>Email:</strong> {{ student.email }}</p>
                        <p><strong>Phone:</strong> {{ student.phone or 'Not provided' }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Address:</strong> {{ student.address or 'Not provided' }}</p>
                        <p><strong>Account Type:</strong> <span class="badge bg-info">{{ student.user_type }}</span></p>
                        <p><strong>Member Since:</strong> {{ student.created_at[:10] if student.created_at else 'Unknown' }}</p>
                        <p><strong>Account Status:</strong> 
                            {% if student.is_active %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-danger">Inactive</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-bar me-2"></i>Statistics</h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <h3 class="text-primary">{{ total_transactions }}</h3>
                    <p class="text-muted">Total Transactions</p>
                </div>
                <hr>
                <div class="text-center">
                    <h3 class="text-warning">{{ active_transactions }}</h3>
                    <p class="text-muted">Books Currently Taken Home</p>
                </div>
                <hr>
                <div class="text-center">
                    <h3 class="text-success">{{ total_transactions - active_transactions }}</h3>
                    <p class="text-muted">Books Returned</p>
                </div>
                <hr>
                <div class="text-center">
                    <h3 class="text-danger">â‚¹{{ "%.2f"|format(student.total_fines if student.total_fines else 0) }}</h3>
                    <p class="text-muted">Unpaid Fines</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-history me-2"></i>Recent Transactions</h5>
            </div>
            <div class="card-body">
                {% if transactions %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Book Title</th>
                                <th>Author</th>
                                <th>Issue Date</th>
                                <th>Due Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in transactions %}
                            <tr>
                                <td>
                                    <strong>{{ transaction.title }}</strong>
                                </td>
                                <td>{{ transaction.author }}</td>
                                <td>{{ transaction.issue_date[:10] if transaction.issue_date else '-' }}</td>
                                <td>{{ transaction.due_date[:10] if transaction.due_date else '-' }}</td>
                                <td>
                                    {% if transaction.status == 'issued' %}
                                        <span class="badge bg-warning">Issued</span>
                                    {% elif transaction.status == 'returned' %}
                                        <span class="badge bg-success">Returned</span>
                                    {% elif transaction.status == 'overdue' %}
                                        <span class="badge bg-danger">Overdue</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ transaction.status }}</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-exchange-alt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No transactions found</h5>
                    <p class="text-muted">This student hasn't borrowed any books yet.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
